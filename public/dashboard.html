<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - SkillSwap</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .sidebar-link:hover { background: #f3f4f6; }
        .sidebar-link.active { background: #ede9fe; color: #7c3aed; font-weight: 600; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg fixed w-full top-0 z-50">
        <div class="container mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-exchange-alt text-2xl text-purple-600"></i>
                    <span class="text-xl font-bold">SkillSwap</span>
                </div>
                <div class="flex items-center space-x-6">
                    <div class="flex items-center space-x-2 bg-purple-50 px-4 py-2 rounded-lg">
                        <i class="fas fa-coins text-purple-600"></i>
                        <span class="font-semibold" id="creditBalance">0</span>
                        <span class="text-sm text-gray-600">credits</span>
                    </div>
                    <button onclick="showBuyCredits()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                        <i class="fas fa-plus mr-2"></i>Buy Credits
                    </button>
                    <div class="relative">
                        <button onclick="toggleNotifications()" class="relative p-2">
                            <i class="fas fa-bell text-xl text-gray-600"></i>
                            <span id="notifBadge" class="hidden absolute top-0 right-0 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                        </button>
                        <div id="notifDropdown" class="hidden absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl max-h-96 overflow-y-auto">
                            <div class="p-4 border-b">
                                <h3 class="font-bold">Notifications</h3>
                            </div>
                            <div id="notificationList" class="divide-y"></div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <img id="userAvatar" src="https://ui-avatars.com/api/?name=User" alt="Avatar" class="w-10 h-10 rounded-full">
                        <span id="userName" class="font-semibold">User</span>
                        <button onclick="logout()" class="text-gray-600 hover:text-gray-800">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="flex pt-16">
        <!-- Sidebar -->
        <aside class="w-64 bg-white h-screen shadow-lg fixed left-0 overflow-y-auto">
            <div class="p-6 space-y-2">
                <a href="#" onclick="showSection('dashboard')" class="sidebar-link active flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-home w-5"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" onclick="showSection('discover')" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-search w-5"></i>
                    <span>Discover Skills</span>
                </a>
                <a href="#" onclick="showSection('sessions')" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-calendar w-5"></i>
                    <span>My Sessions</span>
                </a>
                <a href="#" onclick="showSection('library')" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-book w-5"></i>
                    <span>Learning Library</span>
                </a>
                <a href="#" onclick="showSection('profile')" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-user w-5"></i>
                    <span>My Profile</span>
                </a>
                <a href="#" onclick="showSection('wallet')" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <i class="fas fa-wallet w-5"></i>
                    <span>Wallet</span>
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="ml-64 flex-1 p-8">
            <!-- Dashboard Section -->
            <div id="dashboardSection" class="section">
                <div class="mb-8">
                    <h1 class="text-3xl font-bold mb-2">Welcome back, <span id="welcomeName"></span>! üëã</h1>
                    <p class="text-gray-600">Here's what's happening with your learning journey.</p>
                </div>

                <!-- Stats Cards -->
                <div class="grid md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-lg shadow">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-gray-600">Total Sessions</span>
                            <i class="fas fa-graduation-cap text-purple-600 text-xl"></i>
                        </div>
                        <div class="text-3xl font-bold" id="totalSessions">0</div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-gray-600">Taught</span>
                            <i class="fas fa-chalkboard-teacher text-green-600 text-xl"></i>
                        </div>
                        <div class="text-3xl font-bold text-green-600" id="sessionsTaught">0</div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-gray-600">Learned</span>
                            <i class="fas fa-book-reader text-blue-600 text-xl"></i>
                        </div>
                        <div class="text-3xl font-bold text-blue-600" id="sessionsLearned">0</div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-gray-600">Badges Earned</span>
                            <i class="fas fa-trophy text-yellow-500 text-xl"></i>
                        </div>
                        <div class="text-3xl font-bold text-yellow-500" id="badgesEarned">0</div>
                    </div>
                </div>

                <!-- Upcoming Sessions -->
                <div class="bg-white rounded-lg shadow mb-8">
                    <div class="p-6 border-b">
                        <h2 class="text-xl font-bold">Upcoming Sessions</h2>
                    </div>
                    <div id="upcomingSessions" class="p-6"></div>
                </div>

                <!-- Recommended Content -->
                <div class="bg-white rounded-lg shadow">
                    <div class="p-6 border-b flex justify-between items-center">
                        <h2 class="text-xl font-bold">Recommended for You</h2>
                        <button onclick="showSection('library')" class="text-purple-600 hover:text-purple-800">View All</button>
                    </div>
                    <div id="recommendedContent" class="p-6 grid md:grid-cols-3 gap-6"></div>
                </div>
            </div>

            <!-- Discover Section -->
            <div id="discoverSection" class="section hidden">
                <h1 class="text-3xl font-bold mb-6">Discover Skills</h1>
                
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <div class="flex space-x-4">
                        <input type="text" id="searchInput" placeholder="Search skills, teachers, or content..." class="flex-1 px-4 py-2 border rounded-lg focus:outline-none focus:border-purple-600">
                        <button onclick="performSearch()" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                            <i class="fas fa-search mr-2"></i>Search
                        </button>
                    </div>
                </div>

                <!-- Categories -->
                <div class="mb-6">
                    <h2 class="text-xl font-bold mb-4">Browse by Category</h2>
                    <div class="grid md:grid-cols-5 gap-4">
                        <button onclick="filterByCategory('tech')" class="bg-white p-6 rounded-lg shadow hover:shadow-lg transition text-center">
                            <div class="text-4xl mb-2">üíª</div>
                            <div class="font-semibold">Technology</div>
                        </button>
                        <button onclick="filterByCategory('creative')" class="bg-white p-6 rounded-lg shadow hover:shadow-lg transition text-center">
                            <div class="text-4xl mb-2">üé®</div>
                            <div class="font-semibold">Creative</div>
                        </button>
                        <button onclick="filterByCategory('language')" class="bg-white p-6 rounded-lg shadow hover:shadow-lg transition text-center">
                            <div class="text-4xl mb-2">üó£Ô∏è</div>
                            <div class="font-semibold">Languages</div>
                        </button>
                        <button onclick="filterByCategory('business')" class="bg-white p-6 rounded-lg shadow hover:shadow-lg transition text-center">
                            <div class="text-4xl mb-2">üíº</div>
                            <div class="font-semibold">Business</div>
                        </button>
                        <button onclick="filterByCategory('lifestyle')" class="bg-white p-6 rounded-lg shadow hover:shadow-lg transition text-center">
                            <div class="text-4xl mb-2">üßò</div>
                            <div class="font-semibold">Lifestyle</div>
                        </button>
                    </div>
                </div>

                <!-- Skills List -->
                <div class="bg-white rounded-lg shadow">
                    <div class="p-6 border-b">
                        <h2 class="text-xl font-bold">Available Skills</h2>
                    </div>
                    <div id="skillsList" class="p-6 grid md:grid-cols-2 gap-4"></div>
                </div>
            </div>

            <!-- Sessions Section -->
            <div id="sessionsSection" class="section hidden">
                <h1 class="text-3xl font-bold mb-6">My Sessions</h1>
                
                <div class="flex space-x-4 mb-6">
                    <button onclick="filterSessions('all')" class="px-6 py-2 bg-purple-600 text-white rounded-lg">All</button>
                    <button onclick="filterSessions('pending')" class="px-6 py-2 bg-white rounded-lg hover:bg-gray-100">Pending</button>
                    <button onclick="filterSessions('confirmed')" class="px-6 py-2 bg-white rounded-lg hover:bg-gray-100">Confirmed</button>
                    <button onclick="filterSessions('completed')" class="px-6 py-2 bg-white rounded-lg hover:bg-gray-100">Completed</button>
                </div>

                <div id="sessionsList" class="space-y-4"></div>
            </div>

            <!-- Library Section -->
            <div id="librarySection" class="section hidden">
                <h1 class="text-3xl font-bold mb-6">Learning Library</h1>
                <div id="contentLibrary" class="grid md:grid-cols-3 gap-6"></div>
            </div>

            <!-- Profile Section -->
            <div id="profileSection" class="section hidden">
                <h1 class="text-3xl font-bold mb-6">My Profile</h1>
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="md:col-span-2 bg-white rounded-lg shadow p-6">
                        <h2 class="text-xl font-bold mb-4">Profile Information</h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-gray-700 mb-2">Name</label>
                                <input type="text" id="profileName" class="w-full px-4 py-2 border rounded-lg">
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-2">Bio</label>
                                <textarea id="profileBio" rows="4" class="w-full px-4 py-2 border rounded-lg"></textarea>
                            </div>
                            <button onclick="updateProfile()" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                                Save Changes
                            </button>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-6">
                        <h2 class="text-xl font-bold mb-4">My Skills</h2>
                        <div id="profileSkills" class="space-y-2"></div>
                    </div>
                </div>
            </div>

            <!-- Wallet Section -->
            <div id="walletSection" class="section hidden">
                <h1 class="text-3xl font-bold mb-6">My Wallet</h1>
                
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="text-gray-600 mb-2">Current Balance</div>
                            <div class="text-4xl font-bold text-purple-600" id="walletBalance">0 Credits</div>
                        </div>
                        <button onclick="showBuyCredits()" class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                            <i class="fas fa-plus mr-2"></i>Buy Credits
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow">
                    <div class="p-6 border-b">
                        <h2 class="text-xl font-bold">Transaction History</h2>
                    </div>
                    <div id="transactionHistory" class="divide-y"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Buy Credits Modal -->
    <div id="buyCreditsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold">Buy Credits</h3>
                <button onclick="closeBuyCredits()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="space-y-4 mb-6">
                <button onclick="buyCredits(100)" class="w-full p-4 border-2 border-purple-600 rounded-lg hover:bg-purple-50 flex justify-between items-center">
                    <div>
                        <div class="font-bold text-lg">100 Credits</div>
                        <div class="text-sm text-gray-600">Perfect for trying out</div>
                    </div>
                    <div class="text-xl font-bold text-purple-600">$10</div>
                </button>
                <button onclick="buyCredits(500)" class="w-full p-4 border-2 border-purple-600 rounded-lg hover:bg-purple-50 flex justify-between items-center">
                    <div>
                        <div class="font-bold text-lg">500 Credits</div>
                        <div class="text-sm text-gray-600">Most popular</div>
                    </div>
                    <div class="text-xl font-bold text-purple-600">$45</div>
                </button>
                <button onclick="buyCredits(1000)" class="w-full p-4 border-2 border-purple-600 rounded-lg hover:bg-purple-50 flex justify-between items-center">
                    <div>
                        <div class="font-bold text-lg">1000 Credits</div>
                        <div class="text-sm text-gray-600">Best value!</div>
                    </div>
                    <div class="text-xl font-bold text-purple-600">$80</div>
                </button>
            </div>
            <div class="text-center text-sm text-gray-600">
                <i class="fas fa-lock mr-1"></i>Secure payment processing
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <script>
        const API_BASE = '/api';
        const authToken = localStorage.getItem('authToken');
        const user = JSON.parse(localStorage.getItem('user') || '{}');
        let currentUser = null;

        if (!authToken) {
            window.location.href = '/';
        }

        axios.defaults.headers.common['Authorization'] = `Bearer ${authToken}`;

        async function loadDashboard() {
            try {
                const response = await axios.get(API_BASE + '/dashboard');
                const data = response.data.data;

                currentUser = data.user;
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('welcomeName').textContent = currentUser.name.split(' ')[0];
                document.getElementById('creditBalance').textContent = currentUser.credit_balance;
                document.getElementById('userAvatar').src = currentUser.avatar_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(currentUser.name)}`;

                // Stats
                document.getElementById('totalSessions').textContent = data.stats.total_sessions;
                document.getElementById('sessionsTaught').textContent = data.stats.sessions_taught;
                document.getElementById('sessionsLearned').textContent = data.stats.sessions_learned;
                document.getElementById('badgesEarned').textContent = data.stats.badges_earned;

                // Upcoming sessions
                renderUpcomingSessions(data.upcoming_sessions);
                
                // Recommended content
                renderRecommendedContent(data.recommended_content);

                // Load notifications
                loadNotifications();
            } catch (error) {
                console.error('Dashboard load error:', error);
                if (error.response?.status === 401) {
                    logout();
                }
            }
        }

        function renderUpcomingSessions(sessions) {
            const container = document.getElementById('upcomingSessions');
            if (!sessions || sessions.length === 0) {
                container.innerHTML = '<p class="text-gray-600">No upcoming sessions. <a href="#" onclick="showSection(\'discover\')" class="text-purple-600">Book a session now!</a></p>';
                return;
            }

            container.innerHTML = sessions.map(session => `
                <div class="flex items-center justify-between p-4 border rounded-lg mb-4">
                    <div class="flex items-center space-x-4">
                        <img src="${session.other_user_avatar || 'https://ui-avatars.com/api/?name=User'}" class="w-12 h-12 rounded-full">
                        <div>
                            <div class="font-semibold">${session.title}</div>
                            <div class="text-sm text-gray-600">with ${session.other_user_name}</div>
                            <div class="text-sm text-gray-500">${new Date(session.scheduled_date).toLocaleString()}</div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="px-3 py-1 text-sm rounded-full ${session.status === 'confirmed' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                            ${session.status}
                        </span>
                        <button onclick="viewSession(${session.id})" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 text-sm">
                            View
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function renderRecommendedContent(content) {
            const container = document.getElementById('recommendedContent');
            if (!content || content.length === 0) {
                container.innerHTML = '<p class="text-gray-600 col-span-3">No content available yet.</p>';
                return;
            }

            container.innerHTML = content.slice(0, 3).map(item => `
                <div class="border rounded-lg overflow-hidden hover:shadow-lg transition">
                    <div class="aspect-video bg-gray-200 flex items-center justify-center">
                        <i class="fas fa-play-circle text-5xl text-purple-600"></i>
                    </div>
                    <div class="p-4">
                        <div class="font-semibold mb-2">${item.title}</div>
                        <div class="text-sm text-gray-600 mb-2">${item.creator_name}</div>
                        <div class="flex items-center justify-between text-sm">
                            <span>${item.skill_icon} ${item.skill_name}</span>
                            <span>${item.duration_minutes} min</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        async function loadNotifications() {
            try {
                const response = await axios.get(API_BASE + '/notifications');
                const { notifications, unread_count } = response.data.data;

                if (unread_count > 0) {
                    document.getElementById('notifBadge').classList.remove('hidden');
                    document.getElementById('notifBadge').textContent = unread_count;
                }

                const container = document.getElementById('notificationList');
                if (notifications.length === 0) {
                    container.innerHTML = '<div class="p-4 text-gray-600 text-center">No notifications</div>';
                    return;
                }

                container.innerHTML = notifications.slice(0, 10).map(notif => `
                    <div class="p-4 hover:bg-gray-50 ${notif.is_read ? 'opacity-50' : ''}">
                        <div class="font-semibold text-sm">${notif.title}</div>
                        <div class="text-xs text-gray-600 mt-1">${notif.message}</div>
                        <div class="text-xs text-gray-400 mt-1">${new Date(notif.created_at).toLocaleString()}</div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Notifications load error:', error);
            }
        }

        function toggleNotifications() {
            const dropdown = document.getElementById('notifDropdown');
            dropdown.classList.toggle('hidden');
        }

        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(el => el.classList.add('hidden'));
            document.getElementById(sectionName + 'Section').classList.remove('hidden');

            document.querySelectorAll('.sidebar-link').forEach(el => el.classList.remove('active'));
            event.target.closest('.sidebar-link')?.classList.add('active');

            if (sectionName === 'discover') loadSkills();
            if (sectionName === 'sessions') loadSessions();
            if (sectionName === 'library') loadLibrary();
            if (sectionName === 'profile') loadProfile();
            if (sectionName === 'wallet') loadWallet();
        }

        async function loadSkills() {
            try {
                const response = await axios.get(API_BASE + '/skills');
                const skills = response.data.data;

                const container = document.getElementById('skillsList');
                container.innerHTML = skills.map(skill => `
                    <div class="border rounded-lg p-4 hover:shadow-lg transition cursor-pointer" onclick="viewSkillTeachers(${skill.id})">
                        <div class="flex items-center space-x-3">
                            <div class="text-3xl">${skill.icon || 'üìö'}</div>
                            <div class="flex-1">
                                <div class="font-semibold">${skill.name}</div>
                                <div class="text-sm text-gray-600">${skill.category}</div>
                            </div>
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Skills load error:', error);
            }
        }

        async function loadSessions() {
            try {
                const response = await axios.get(API_BASE + '/sessions');
                const sessions = response.data.data;

                const container = document.getElementById('sessionsList');
                if (sessions.length === 0) {
                    container.innerHTML = '<div class="bg-white rounded-lg shadow p-8 text-center text-gray-600">No sessions yet. <a href="#" onclick="showSection(\'discover\')" class="text-purple-600">Book your first session!</a></div>';
                    return;
                }

                container.innerHTML = sessions.map(session => `
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex justify-between items-start">
                            <div class="flex space-x-4">
                                <img src="${session.teacher_id === currentUser.id ? session.learner_avatar : session.teacher_avatar}" class="w-16 h-16 rounded-full">
                                <div>
                                    <div class="font-bold text-lg">${session.title}</div>
                                    <div class="text-sm text-gray-600">
                                        ${session.teacher_id === currentUser.id ? 'Teaching' : 'Learning'} ${session.skill_name}
                                    </div>
                                    <div class="text-sm text-gray-600">
                                        ${session.teacher_id === currentUser.id ? 'with ' + session.learner_name : 'from ' + session.teacher_name}
                                    </div>
                                    <div class="text-sm text-gray-500 mt-1">${new Date(session.scheduled_date).toLocaleString()}</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="px-3 py-1 text-sm rounded-full ${
                                    session.status === 'completed' ? 'bg-green-100 text-green-800' :
                                    session.status === 'confirmed' ? 'bg-blue-100 text-blue-800' :
                                    session.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :
                                    'bg-gray-100 text-gray-800'
                                }">${session.status}</span>
                                <div class="text-sm text-gray-600 mt-2">${session.credit_cost} credits</div>
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Sessions load error:', error);
            }
        }

        async function loadLibrary() {
            try {
                const response = await axios.get(API_BASE + '/content');
                const content = response.data.data;

                const container = document.getElementById('contentLibrary');
                container.innerHTML = content.map(item => `
                    <div class="bg-white rounded-lg shadow overflow-hidden hover:shadow-xl transition">
                        <div class="aspect-video bg-gray-200 flex items-center justify-center">
                            <i class="fas fa-play-circle text-5xl text-purple-600 cursor-pointer" onclick="viewContent(${item.id})"></i>
                        </div>
                        <div class="p-4">
                            <div class="font-semibold mb-2">${item.title}</div>
                            <div class="flex items-center space-x-2 text-sm text-gray-600 mb-2">
                                <img src="${item.creator_avatar}" class="w-6 h-6 rounded-full">
                                <span>${item.creator_name}</span>
                            </div>
                            <div class="flex items-center justify-between text-sm">
                                <span>${item.skill_icon} ${item.skill_name}</span>
                                <span class="text-gray-500">${item.duration_minutes} min</span>
                            </div>
                            <div class="mt-2 text-xs text-gray-500">
                                <i class="fas fa-eye"></i> ${item.view_count} views
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Library load error:', error);
            }
        }

        async function loadProfile() {
            document.getElementById('profileName').value = currentUser.name;
            document.getElementById('profileBio').value = currentUser.bio || '';
        }

        async function loadWallet() {
            document.getElementById('walletBalance').textContent = currentUser.credit_balance + ' Credits';

            try {
                const response = await axios.get(API_BASE + `/users/${currentUser.id}/transactions`);
                const transactions = response.data.data;

                const container = document.getElementById('transactionHistory');
                container.innerHTML = transactions.map(tx => `
                    <div class="p-4 flex justify-between items-center">
                        <div>
                            <div class="font-semibold">${tx.description}</div>
                            <div class="text-sm text-gray-500">${new Date(tx.created_at).toLocaleString()}</div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold ${tx.amount > 0 ? 'text-green-600' : 'text-red-600'}">
                                ${tx.amount > 0 ? '+' : ''}${tx.amount}
                            </div>
                            <div class="text-sm text-gray-500">Balance: ${tx.balance_after}</div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Wallet load error:', error);
            }
        }

        function showBuyCredits() {
            document.getElementById('buyCreditsModal').classList.remove('hidden');
            document.getElementById('buyCreditsModal').classList.add('flex');
        }

        function closeBuyCredits() {
            document.getElementById('buyCreditsModal').classList.add('hidden');
            document.getElementById('buyCreditsModal').classList.remove('flex');
        }

        async function buyCredits(amount) {
            try {
                const response = await axios.post(API_BASE + '/credits/purchase', {
                    amount,
                    payment_intent_id: 'demo_' + Date.now()
                });

                if (response.data.success) {
                    alert(`Successfully purchased ${amount} credits!`);
                    currentUser.credit_balance = response.data.data.new_balance;
                    document.getElementById('creditBalance').textContent = currentUser.credit_balance;
                    closeBuyCredits();
                    loadDashboard();
                }
            } catch (error) {
                alert('Purchase failed. Please try again.');
            }
        }

        function logout() {
            localStorage.removeItem('authToken');
            localStorage.removeItem('user');
            window.location.href = '/';
        }

        // Initialize
        loadDashboard();
    </script>
</body>
</html>
